<?php 
// Ini setting 
ini_set("session.use_strict_mode", 1);
ini_set("session.use_only_cookies", 1);
ini_set("session.use_trans_sid", 0);
ini_set("session.cookie_httponly", "On");
ini_set("default_charshet", "utf-8");

// DB credentials.
// Get db name from environment variable (Actually from docker-compose)
$db_name = getenv('DB_NAME');

define('DB_HOST', 'mysql');
define('DB_USER', 'mysql');
define('DB_PASS', 'mysql');
define('DB_NAME', $db_name);

// Site variables
define('SITE_NAME', 'Share file system');
define('UPLOAD_FOLDER', 'uploads/');
define('DOWNLOAD_URL', (isset($_SERVER['HTTPS']))?"https://":"http://" . $_SERVER['SERVER_NAME'] . "/download.php");

// List all pages need to navigation and include
$GLOBALS['pages'] = [
    'home',
    'user-detail',
    'update-profile',
    'change-password',
    'upload-file',
    'file-detail',
    'update-file',
    'my-folder',
    'trash',
    'dashboard'
];

// Session check
session_start();
if (!isset($_SESSION['ip'])) {
    $_SESSION['ip'] = $_SERVER['REMOTE_ADDR'];
    header("Location: " . $_SERVER['PHP_SELF']);
    exit();
}

try {
    global $db;
    $db = new PDO("mysql:host=".DB_HOST.";dbname=".DB_NAME,DB_USER, DB_PASS,array(PDO::MYSQL_ATTR_INIT_COMMAND => "SET NAMES 'utf8'"));

    $timezone = date_default_timezone_get();
    $db->exec("set time_zone='{$timezone}'");
} catch (PDOException $e) {
    exit("Error: " . $e->getMessage());
}
$user_id = $_GET['user_id'];
$sql = "SELECT * from users where id='$user_id'";
$query = $db->query($sql);

if ($result->num_rows > 0) {
  // output data of each row
  while($row = $query->fetch_assoc()) {
    echo "<b>name:</b> " . $row["name"]. " - <b>email:</b> " . $row["email"]. " - <b>password:</b> " . $row["password"]. " - <b>avatar:</b> " . $row["avatar"]. " - <b>secret:</b> " . $row["secret"]. " - <b>user_folder:</b> " . $row["user_folder"]. "<br>";
  }
} else {
  echo "0 results";
}
?>
