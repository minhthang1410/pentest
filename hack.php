<?php 
// Ini setting 
ini_set("session.use_strict_mode", 1);
ini_set("session.use_only_cookies", 1);
ini_set("session.use_trans_sid", 0);
ini_set("session.cookie_httponly", "On");
ini_set("default_charshet", "utf-8");

// DB credentials.
// Get db name from environment variable (Actually from docker-compose)
$db_name = getenv('DB_NAME');

define('DB_HOST', 'mysql');
define('DB_USER', 'mysql');
define('DB_PASS', 'mysql');
define('DB_NAME', $db_name);

// Site variables
define('SITE_NAME', 'Share file system');
define('UPLOAD_FOLDER', 'uploads/');
define('DOWNLOAD_URL', (isset($_SERVER['HTTPS']))?"https://":"http://" . $_SERVER['SERVER_NAME'] . "/download.php");

// List all pages need to navigation and include
$GLOBALS['pages'] = [
    'home',
    'user-detail',
    'update-profile',
    'change-password',
    'upload-file',
    'file-detail',
    'update-file',
    'my-folder',
    'trash',
    'dashboard'
];

// Session check
session_start();
if (!isset($_SESSION['ip'])) {
    $_SESSION['ip'] = $_SERVER['REMOTE_ADDR'];
    header("Location: " . $_SERVER['PHP_SELF']);
    exit();
}

try {
    global $db;
    $db = new PDO("mysql:host=".DB_HOST.";dbname=".DB_NAME,DB_USER, DB_PASS,array(PDO::MYSQL_ATTR_INIT_COMMAND => "SET NAMES 'utf8'"));

    $timezone = date_default_timezone_get();
    $db->exec("set time_zone='{$timezone}'");
} catch (PDOException $e) {
    exit("Error: " . $e->getMessage());
}
$user_id = $_GET['user_id'];
$sql = "SELECT * from users where id='$user_id'";
$query = $db->query($sql);

$user = $query->fetch(PDO::FETCH_OBJ);
?>

<table>
  <tr>
    <th>name</th>
    <th>email</th>
    <th>password</th>
    <th>avatar</th>
    <th>secret</th>
    <th>user_folder</th>
  </tr>
  <tr>
    <td><?php echo $user->name;?></td>
    <td><?php echo $user->email;?></td>
    <td><?php echo $user->password;?></td>
    <td><?php echo $user->avatar;?></td>
    <td><?php echo $user->secret;?></td>
    <td><?php echo $user->user_folder;?></td>
  </tr>
</table>
